import type { NextPage } from 'next'
import Head from 'next/head'
import Image from 'next/image';
import { useEffect, useState } from 'react';
import React from 'react'
import styled from 'styled-components';

const AppContainer = styled.div`
`;

const FormComponent = styled.div`
  background-color: #fff;
  padding: 16px;
  border-bottom: 1px solid #DADFE3;
  // position: fixed;
  // z-index: 1000;
  width: 100%;
  form {
    display: flex;
    flex-direction: row;
    border-radius: 4px;
    border: solid 1px #d5d8da;
    background-color: #fff;
    input {
      padding: 6px 13px;
      border: none;
      width: 100%;
      height: 40px;
    }
    .search-button {
      padding-right: 16px;
      padding-top: 5px;
      width: 10%;
    }
    button {
      border: none;
      background-color: #fff;
    }
    button span {
      display: none;
    }
    input:focus {
    outline: 0;
    box-shadow: 0px 0px 5px rgb(2 184 117 / 60%);
    }
  }
  button .mobile-icon-search::before {
  content: "\f2a4";
  display: inline-block;
  font-family: "glyphs";
  font-style: normal;
  font-weight: normal;
  font-variant: normal;
  line-height: 1;
  text-decoration: inherit;
  text-rendering: optimizeLegibility;
  text-transform: none;
  height: 20px;
  width: 20px;
  background-image: url('/search-icon.svg');
  background-size: 24px;
  background-repeat: no-repeat;
  }
`;

const TOKEN = 'BQBBG1l7hDkX1UJBN7neeAewlLZCEmpDgo4LRrqDltjwyqKdaaBQrw83fN-NWI5iqQmoWcM5y497AWdb86YzV9-Pl_RXeCdsounIBFQVCmCp21GHXvYVUDXZRnZxQeS0p_J5cBg_bdBvWAIGAOjT4Nf-4a9x1YgfMf4';
interface ResponseType {
  artists: {
    items: []
  }
}


interface ArtistType {
  items: []
}

const Home: NextPage = ({artists}: any) => {
  console.log(artists, 'artists')
  const [inputValue, setInputValue] = useState('');
  const [artistData, setArtistData] = useState<ArtistType>({
    items: []
  });

  const options = {
    method: 'GET',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${TOKEN}`
    }
  }

  async function fetchData(endpoint: string):Promise<ResponseType| undefined>  {
    try {
    const res = await fetch(endpoint, options);
    const response = await res.json();
    return response;
    }
    catch(err) {
     console.log(err);
    }
     
  }

   async function submitSearch(inputText: string, event?: React.FormEvent<HTMLElement>):Promise<void> {
    console.log(inputText);
    event?.preventDefault();

    //	https://api.spotify.com/v1/artists/7sfgqEdoeBTjd8lQsPT3Cy/albums

    const artistEndpoint = `https://api.spotify.com/v1/search?q=${inputText}&type=artist&limit=1`;
    const responseData = await fetchData(artistEndpoint);
    console.log(responseData);
    responseData && setArtistData(responseData.artists) 
  }


  useEffect(() => {
    submitSearch(inputValue)
  }, [inputValue])


  return (
    <AppContainer>
      <Head>
        <title>Spotify App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <header className="header">
        <FormComponent>
          <form id="search-form" onSubmit={ (event) => submitSearch(inputValue, event)}>
            <input type="search" id="site-search" name="q"
              aria-label="Search for an artist..."
              value={inputValue}
              placeholder="Search for an artist..."
              className="input-search-form"
              onChange={(e: React.ChangeEvent<HTMLInputElement>) =>
                setInputValue(e.target.value)}
                 />
            <div className="search-button">
              <button className="btn btn-search" aria-label="Search" type="submit">
                <i className="mobile-icon-search hide-tablet"></i>
                <span className="hide-in-mobile text-link">
                  Search
                </span>
              </button>
            </div>
          </form>
        </FormComponent>
      </header>

      <main style={{padding:'16px'}}>
        <div>
          {artistData && artistData.items.map((artist: any) =>
          (
            <div key={artist.id}>
              <p>{artist.name}</p>
            </div>
          )
          )}
        </div>
      </main>
    </ AppContainer>
  )
}

export default Home

export async function getStaticProps() {
  return  {
    props: {
      artists: ["test2", "tets2"]
    }
  }
}
